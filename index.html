<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaskPilot — Daily AI Scheduler</title>
  <meta name="description" content="A clean, Azure-ready frontend for a Daily Task Scheduler app.">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' rx='12' fill='%230EA5E9'/%3E%3Cpath d='M46 22H18a2 2 0 0 0-2 2v22a2 2 0 0 0 2 2h28a2 2 0 0 0 2-2V24a2 2 0 0 0-2-2Zm-1 7H19v-3h26v3Z' fill='white'/%3E%3Cpath d='M40 18v6M24 18v6' stroke='white' stroke-width='3' stroke-linecap='round'/%3E%3C/svg%3E" />
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: {
            soft: '0 10px 30px rgba(2, 6, 23, 0.06)'
          }
        }
      }
    };
  </script>
  <style>
    :root {
      --accent: #0ea5e9;
    }
    .btn-primary {
      @apply inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2 font-medium shadow-soft transition active:scale-[0.98];
      background: var(--accent);
      color: white;
    }
    .btn-outline {
      @apply inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2 font-medium border transition;
      border-color: color-mix(in oklab, var(--accent) 50%, #94a3b8);
      color: color-mix(in oklab, var(--accent) 90%, #0f172a);
    }
    .chip {
      @apply inline-flex items-center gap-2 rounded-xl px-2.5 py-1 text-xs font-medium border;
      border-color: color-mix(in oklab, var(--accent) 50%, #cbd5e1);
      color: color-mix(in oklab, var(--accent) 70%, #334155);
    }
    .card {
      @apply bg-white/90 dark:bg-slate-900/60 backdrop-blur rounded-3xl p-5 shadow-soft ring-1 ring-slate-200/70 dark:ring-slate-700/60;
    }
    .muted { @apply text-slate-500 dark:text-slate-400; }
    .kbd { @apply px-1.5 py-0.5 rounded border bg-slate-50 dark:bg-slate-800 text-xs; }
    .srch {
      @apply w-full rounded-2xl border px-4 py-2.5 outline-none focus:ring-4 transition;
      border-color: color-mix(in oklab, var(--accent) 40%, #cbd5e1);
      box-shadow: 0 0 0 0 rgba(0,0,0,0);
    }
    .srch:focus {
      box-shadow: 0 0 0 6px color-mix(in oklab, var(--accent) 15%, transparent);
      border-color: var(--accent);
    }
    .switch {
      @apply relative inline-flex h-6 w-11 items-center rounded-full transition;
      background: color-mix(in oklab, var(--accent) 20%, #e2e8f0);
    }
    .switch-dot {
      @apply inline-block h-5 w-5 transform rounded-full bg-white shadow transition;
    }
    .tooltip { @apply relative; }
    .tooltip:hover:after {
      content: attr(data-tip);
      @apply absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap rounded-xl bg-slate-900 text-white text-xs px-2 py-1 shadow;
    }
    .grid-autofill {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .dark body, body.dark { background: #0b1220; color: #e5e7eb; }
  </style>
</head>
<body class="min-h-dvh bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 selection:bg-cyan-200/60 dark:selection:bg-cyan-400/30">
  <!-- App Shell -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
    <header class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-2xl grid place-items-center" style="background: color-mix(in oklab, var(--accent) 85%, #0ea5e9)">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-6 text-white" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 8V7a4 4 0 1 1 8 0v1h1a3 3 0 0 1 3 3v7a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3v-7a3 3 0 0 1 3-3h1Z"/>
            <path d="M9 7a3 3 0 1 1 6 0v1H9V7Z"/>
          </svg>
        </div>
        <div>
          <h1 class="text-xl font-semibold tracking-tight">TaskPilot <span class="chip ml-2">Frontend</span></h1>
          <p class="muted text-sm">Azure-ready UI for your Daily AI Scheduler</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="hidden sm:flex items-center gap-2">
          <span class="muted text-sm">Accent</span>
          <input id="accentPicker" type="color" class="h-9 w-9 rounded-xl border cursor-pointer" value="#0ea5e9" />
        </div>
        <button id="themeToggle" class="btn-outline" type="button" title="Toggle theme">
          <svg class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364 6.364-1.414-1.414M7.05 8.05 5.636 6.636m12.728 0-1.414 1.414M7.05 15.95l-1.414 1.414" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span class="hidden sm:inline">Theme</span>
        </button>
        <a class="btn-primary" href="https://learn.microsoft.com/azure/static-web-apps/" target="_blank" rel="noreferrer">
          Deploy on Azure
          <svg class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M7 17 17 7M7 7h10v10" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>
    </header>

    <!-- Config bar -->
    <section class="mt-6 card">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div class="flex items-center gap-3">
          <span class="chip">Mode</span>
          <label class="flex items-center gap-2">
            <span class="muted text-sm">Demo</span>
            <div class="switch" role="switch" aria-checked="true">
              <input id="demoToggle" type="checkbox" class="absolute inset-0 opacity-0 peer cursor-pointer" checked/>
              <span class="switch-dot translate-x-1 peer-checked:translate-x-6"></span>
            </div>
            <span class="muted text-sm">API</span>
          </label>
        </div>
        <div class="flex-1 md:max-w-xl">
          <input id="apiBase" class="srch" placeholder="API Base URL (e.g. /api)" value="/api" />
          <p class="muted text-xs mt-1">Set <span class="kbd">/api</span> for Azure Static Web Apps Functions, or your full Functions URL.</p>
        </div>
        <div class="flex gap-2">
          <button id="saveConfig" class="btn-outline">Save Config</button>
          <span id="savedBadge" class="chip hidden">Saved</span>
        </div>
      </div>
    </section>

    <!-- Main grid -->
    <main class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left column: Task editor -->
      <section class="lg:col-span-2 card">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Tasks</h2>
          <div class="flex items-center gap-2">
            <button id="importFromText" class="btn-outline tooltip" data-tip="Paste tasks (one per line)">Quick Import</button>
            <button id="addTask" class="btn-primary">Add Task</button>
          </div>
        </div>

        <div class="mt-4 overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="text-left muted">
              <tr>
                <th class="py-2 pr-2">Task</th>
                <th class="py-2 pr-2">Estimate (min)</th>
                <th class="py-2 pr-2">Priority</th>
                <th class="py-2"></th>
              </tr>
            </thead>
            <tbody id="taskBody"></tbody>
          </table>
        </div>

        <div class="mt-5 grid grid-cols-1 md:grid-cols-3 gap-3">
          <label class="block">
            <span class="muted text-xs">Start Time</span>
            <input id="startTime" type="time" class="srch" value="09:00" />
          </label>
          <label class="block">
            <span class="muted text-xs">Workday (hours)</span>
            <input id="workHours" type="number" class="srch" value="8" min="1" max="24"/>
          </label>
          <label class="block">
            <span class="muted text-xs">Break every (min)</span>
            <input id="breakEvery" type="number" class="srch" value="90" min="15" step="15"/>
          </label>
        </div>

        <div class="mt-5 flex flex-wrap items-center gap-3">
          <button id="generateBtn" class="btn-primary">
            <svg class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 5v14m-7-7h14" stroke-width="2" stroke-linecap="round"/></svg>
            Generate Schedule
          </button>
          <button id="clearTasks" class="btn-outline">Clear Tasks</button>
          <span class="muted text-xs">Tip: Reorder with priorities; add time estimates for better results.</span>
        </div>
      </section>

      <!-- Right column: Inspiration -->
      <aside class="card">
        <h2 class="text-lg font-semibold">Inspiration</h2>
        <div class="mt-3 flex gap-2">
          <button id="quoteBtn" class="btn-outline">Get Motivational Quote</button>
          <button id="imageBtn" class="btn-outline">Generate Image</button>
        </div>
        <blockquote id="quoteBox" class="mt-4 italic text-slate-700 dark:text-slate-200">
          “Your day is a collection of deliberate choices.”
        </blockquote>
        <img id="motivationImage" alt="Motivational" class="mt-4 w-full rounded-2xl ring-1 ring-slate-200/70 dark:ring-slate-700/60 hidden" />
      </aside>
    </main>

    <!-- Output -->
    <section class="mt-6 card">
      <div class="flex items-center gap-3 justify-between">
        <h2 class="text-lg font-semibold">Schedule</h2>
        <button id="exportBtn" class="btn-outline">Export JSON</button>
      </div>
      <div id="scheduleBox" class="mt-4 grid-autofill"></div>
    </section>

    <footer class="mt-10 flex flex-col sm:flex-row items-center justify-between gap-3 text-xs muted">
      <div class="flex items-center gap-2">
        <span class="chip">v1.0</span>
        <span>Client-side only. Ready for Azure Functions at <span class="kbd">/api</span>.</span>
      </div>
      <div>© TaskPilot — MIT License</div>
    </footer>
  </div>

  <!-- App Script -->
  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const store = {
      config: {
        demo: true,
        apiBase: "/api",
        accent: "#0ea5e9",
        theme: (localStorage.getItem("taskpilot-theme") ?? document.documentElement.classList.contains('dark') ? "dark" : "light")
      },
      tasks: [],
      schedule: []
    };

    function saveConfig() {
      localStorage.setItem("taskpilot-config", JSON.stringify(store.config));
      $("#savedBadge").classList.remove("hidden");
      setTimeout(() => $("#savedBadge").classList.add("hidden"), 1200);
      applyAccent(store.config.accent);
      applyTheme(store.config.theme);
    }

    function loadConfig() {
      const raw = localStorage.getItem("taskpilot-config");
      if (raw) {
        try {
          const cfg = JSON.parse(raw);
          Object.assign(store.config, cfg);
        } catch {}
      }
      $("#demoToggle").checked = store.config.demo;
      $("#apiBase").value = store.config.apiBase;
      $("#accentPicker").value = store.config.accent;
      applyAccent(store.config.accent);
      applyTheme(store.config.theme);
    }

    function applyAccent(color) {
      document.documentElement.style.setProperty("--accent", color);
    }
    function applyTheme(theme) {
      if (theme === "dark") document.body.classList.add("dark");
      else document.body.classList.remove("dark");
    }

    // Task table helpers
    function addTaskRow(task = { title: "", minutes: 30, priority: 3 }) {
      store.tasks.push(task);
      renderTasks();
    }
    function removeTaskRow(idx) {
      store.tasks.splice(idx, 1);
      renderTasks();
    }
    function renderTasks() {
      const tbody = $("#taskBody");
      tbody.innerHTML = "";
      store.tasks.forEach((t, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="py-2 pr-2">
            <input class="srch w-full" value="${t.title ?? ""}" placeholder="e.g., Write project status email" data-field="title" data-idx="${i}" />
          </td>
          <td class="py-2 pr-2">
            <input class="srch w-28" type="number" min="5" step="5" value="${t.minutes ?? 30}" data-field="minutes" data-idx="${i}" />
          </td>
          <td class="py-2 pr-2">
            <select class="srch w-36" data-field="priority" data-idx="${i}">
              ${[1,2,3,4,5].map(p => `<option value="${p}" ${Number(t.priority)===p?"selected":""}>${p} — ${["Critical","High","Medium","Low","Someday"][p-1]}</option>`).join("")}
            </select>
          </td>
          <td class="py-2">
            <button class="btn-outline" data-del="${i}">Remove</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function parseTimeStr(hhmm) {
      const [h, m] = hhmm.split(":").map(Number);
      const d = new Date();
      d.setHours(h, m, 0, 0);
      return d;
    }
    function fmtTime(d) {
      return d.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
    }

    async function callApi(path, payload) {
      const url = (store.config.apiBase || "/api") + path;
      const r = await fetch(url, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload || {})
      });
      if (!r.ok) throw new Error("API error: " + r.status);
      return await r.json();
    }

    // Demo algorithms (client-side only, no AI)
    function demoSchedule({ tasks, startTime, workMinutes, breakEvery }) {
      // Sort tasks by priority ascending (1 is highest), then by minutes desc
      const items = tasks.slice().sort((a,b)=> (a.priority - b.priority) || (b.minutes - a.minutes));
      const out = [];
      let cursor = new Date(startTime);
      let minsDone = 0;
      for (const t of items) {
        if (minsDone + t.minutes > workMinutes) break;
        const start = new Date(cursor);
        const end = new Date(cursor.getTime() + t.minutes*60000);
        out.push({ title: t.title, start: fmtTime(start), end: fmtTime(end), minutes: t.minutes, priority: t.priority });
        cursor = new Date(end);
        minsDone += t.minutes;
        if (breakEvery && minsDone % breakEvery === 0) {
          const bStart = new Date(cursor);
          const bEnd = new Date(cursor.getTime() + 10*60000);
          out.push({ title: "Break", start: fmtTime(bStart), end: fmtTime(bEnd), minutes: 10, priority: "-" });
          cursor = new Date(bEnd);
          minsDone += 10;
        }
      }
      return out;
    }

    function renderSchedule(list) {
      const box = $("#scheduleBox");
      box.innerHTML = "";
      if (!list || list.length === 0) {
        box.innerHTML = `<p class="muted">No schedule yet. Add tasks and click <b>Generate Schedule</b>.</p>`;
        return;
      }
      list.forEach(item => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="font-medium">${item.title}</div>
            <span class="chip">${item.start} – ${item.end}</span>
          </div>
          <div class="mt-2 text-sm muted">Duration: ${item.minutes} min ${item.priority!=="-"?`· Priority ${item.priority}`:""}</div>
        `;
        box.appendChild(el);
      });
    }

    function svgFromQuote(q) {
      const width = 1200, height = 630;
      const esc = (s)=>s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
      const bg = 'hsl(200 80% 96%)';
      const stroke = 'hsl(200 50% 30%)';
      const accent = getComputedStyle(document.documentElement).getPropertyValue("--accent").trim() || "#0ea5e9";
      return `data:image/svg+xml;charset=utf8,${encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' width='${width}' height='${height}'>
          <defs>
            <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
              <stop offset='0' stop-color='${accent}' stop-opacity='0.15'/>
              <stop offset='1' stop-color='${accent}' stop-opacity='0.05'/>
            </linearGradient>
          </defs>
          <rect width='100%' height='100%' fill='${bg}'/>
          <rect x='40' y='40' width='1120' height='550' rx='36' fill='url(#g)' stroke='${stroke}' stroke-opacity='0.1'/>
          <g transform='translate(80 100)'>
            <circle cx='24' cy='24' r='24' fill='${accent}'/>
            <text x='70' y='34' font-family='Inter, ui-sans-serif' font-size='28' fill='${stroke}'>TaskPilot</text>
          </g>
          <foreignObject x='80' y='160' width='1040' height='360'>
            <div xmlns='http://www.w3.org/1999/xhtml' style='font-family:Inter,ui-sans-serif;color:${stroke};font-size:40px;line-height:1.3'>
              <div>&ldquo;${esc(q)}&rdquo;</div>
              <div style='margin-top:20px;font-size:20px;opacity:0.65'>— Generated locally</div>
            </div>
          </foreignObject>
        </svg>
      `)}`;
    }

    // Event bindings
    document.addEventListener("input", (e) => {
      const el = e.target;
      if (el.dataset && el.dataset.field) {
        const idx = Number(el.dataset.idx);
        const field = el.dataset.field;
        const val = field === "minutes" || field === "priority" ? Number(el.value) : el.value;
        store.tasks[idx][field] = val;
      }
    });
    document.addEventListener("click", (e) => {
      const del = e.target.closest("[data-del]");
      if (del) removeTaskRow(Number(del.dataset.del));
    });

    $("#addTask").addEventListener("click", () => addTaskRow());
    $("#clearTasks").addEventListener("click", () => { store.tasks = []; renderTasks(); renderSchedule([]); });
    $("#importFromText").addEventListener("click", () => {
      const text = prompt("Paste tasks (one per line). You can append time like: \"Task name | 45 | priority 2\"");
      if (!text) return;
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      lines.forEach(l => {
        const parts = l.split("|").map(s => s.trim());
        addTaskRow({
          title: parts[0] || "Untitled task",
          minutes: Number(parts[1] || 30),
          priority: Number((parts[2]||"").match(/\d+/)?.[0] || 3)
        });
      });
    });

    $("#generateBtn").addEventListener("click", async () => {
      const start = parseTimeStr($("#startTime").value);
      const workMinutes = Number($("#workHours").value) * 60;
      const breakEvery = Number($("#breakEvery").value);

      const payload = { tasks: store.tasks, startTime: start.toISOString(), workMinutes, breakEvery };
      try {
        let result;
        if (store.config.demo) {
          result = demoSchedule({ ...payload, startTime: start });
        } else {
          result = await callApi("/generateSchedule", payload);
        }
        store.schedule = result;
        renderSchedule(result);
      } catch (err) {
        alert("Could not generate schedule. " + err.message);
      }
    });

    $("#quoteBtn").addEventListener("click", async () => {
      try {
        let data;
        if (store.config.demo) {
          const samples = [
            "Small steps, stacked daily, create outsized outcomes.",
            "Focus on the next block; excellence compounds.",
            "Protect your mornings; they protect your momentum."
          ];
          data = { quote: samples[Math.floor(Math.random()*samples.length)] };
        } else {
          data = await callApi("/motivation", {});
        }
        $("#quoteBox").textContent = `“${data.quote}”`;
      } catch (err) { alert("Could not fetch quote. " + err.message); }
    });

    $("#imageBtn").addEventListener("click", async () => {
      const quote = $("#quoteBox").textContent.replace(/^“|”$/g,"") || "Own your day.";
      try {
        let url;
        if (store.config.demo) {
          url = svgFromQuote(quote);
        } else {
          const data = await callApi("/motivationImage", { prompt: quote });
          url = data.url;
        }
        const img = $("#motivationImage");
        img.src = url;
        img.classList.remove("hidden");
      } catch (err) { alert("Could not generate image. " + err.message); }
    });

    $("#exportBtn").addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(store.schedule, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "schedule.json";
      a.click();
    });

    $("#saveConfig").addEventListener("click", () => {
      store.config.demo = $("#demoToggle").checked;
      store.config.apiBase = $("#apiBase").value.trim() || "/api";
      store.config.accent = $("#accentPicker").value;
      saveConfig();
    });

    $("#accentPicker").addEventListener("input", (e) => {
      applyAccent(e.target.value);
    });

    $("#themeToggle").addEventListener("click", () => {
      store.config.theme = (store.config.theme === "dark" ? "light" : "dark");
      saveConfig();
    });

    // Seed with some example tasks
    function seed() {
      const init = [
        { title: "Plan day & inbox triage", minutes: 25, priority: 2 },
        { title: "Finish report draft", minutes: 90, priority: 1 },
        { title: "Team standup", minutes: 15, priority: 1 },
        { title: "Client follow-ups", minutes: 40, priority: 3 },
        { title: "Deep work block", minutes: 120, priority: 2 }
      ];
      init.forEach(addTaskRow);
    }

    loadConfig();
    seed();
    renderSchedule([]);
  </script>
</body>
</html>
